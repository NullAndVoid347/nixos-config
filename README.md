# Modular NixOS Config

**Features:**

- Flakes - to greatly expand nix and nixos options
- Home-Manager - for managing dotfiles and /home
- Sops-nix - for secrets encryption
- Stylix - for custom theming

## Table of Content

- [Table of Content](#table-of-content)
- [Architecture](#architecture)
- [Installation](#installation)
- [Documentation](#documentation)
- [To-Dos](#todos)

## Architecture

### /configs

This directory contains host-specific configurations.
This is where all customization and personalization should take place.

**Each host includes:**

- `secrets/` for sensitive data (encrypted to allow source control)
- `configuration.nix` for system-wide settings
- `hardware-configuration` which you copied from local install during [Installation](#installation)
- `home.nix` for user-level configuration
- `variables.nix` for global variables

### /modules

Contains all host-agnostic options you can add to your configs to expand functionality

**Subfolders:**

- `apps` is a collection of apps configured with home-manager
- `hardware` is used to enable different hardware configurations
- `scripts` is a folder for scripts
- `services` are systemd, containers, etc that run in background. Useful for servers
- `system` is "OS" level configuration
- `themes` is where any custom defined theming or apperance should go. Mainly
[stylix](https://stylix.danth.me/) configurations. Check out the available
themes and learn how to create your own in [THEMES.md](docs/THEMES.md)

### / (root)

Parent/root/top level of repo and therefore also your `~/.config/nixos`

**Contents:**

- `.github/docs/to-do.md` is my scratch pad for ideas, tasks, and code scraps; can/should be deleted
- `.gitignore` is used to add anything you dont want checked in
- `flack.lock` is autogenerated and updated whenever you "rebuild", should be source controlled to allow reproducable builds
- `flack.nix` is your "root"/entrypoint/package manager of your configuration, calls and references everything else.
- `LICENSE`
- `README.md` This document

> [!TIP]
> Anything else not listed should most likely not be checked in but during `rebuild` may be created here.
> For example: `.sops.yaml`, etc

### /legacy

Folders and files from source repo, haven't updated/refactored/cleaned up to work with new desired scheme yet.

## Installation

1. [Fork](https://github.com/NullAndVoid347/nixos-config/fork) this repo and clone it to
   your system:

```sh
git clone https://github.com/NullAndVoid347/nixos-config ~/.config/nixos
```

2. Copy and Paste an existing `configs/$hostname` folder to use as a foundation to get you started and rename it to match your systemâ€™s hostname.
3. Update all contents of newly created folder to match your desired use case for the host you are configuring.
4. Copy your existing `hardware-configuration.nix` into your new host's folder to ensure proper hardware support.
5. Register your new host in `flake.nix` by adding it under nixosConfigurations (remove or comment out not needed hosts/configs).
6. (Bonus/Extra) - Update `secrets/` with your own age/sops-nix encrypted values, or remove entirely.
  - Leaving them in won't cause any problems, but should remove if not used.
  - Instructions to encrypt with sops-nix will be added later. - #TODO

> [!TIP]
> When you add new files, don't forget to run `git add .` to add them to the git
> repository

5. Build the system

```sh
sudo nixos-rebuild switch --flake ~/.config/nixos#yourhostname
```

## Documentation

- [Source Repo](https://github.com/anotherhadi/nixy): Source repo has many more mature features, better reference than this repo for more advanced configuration
- [LICENSE](LICENSE): MIT License

## To-Dos

- See if you can inherit all inputs generically in flake.nix
- try to make configuration.nix and home.nix generic and definied in flake.nix
  - have all imports and custom stuff instead be variables.nix entries
  - try to make secrets/default.nix also generic, in flake.nix, and a entry in variables.nix
    - maybe can have all generic parts in modules/system/sops and have variables pass in proper values
- try to move system-packages.nix into variables.nix as well
- Update Readme:
  - with Instructions for implementing sops-nix
  - with instructions for updating flake.nix - `inputs.nixos-hardware.nixosModules.framework-amd-ai-300-series`
  - with instructions for updating flake.nix - hostname references
- Start cleaning up `./legacy/` folder and moving into `./modules/`
- Look into more themes and implementing them
- Add Cosmic DE
- look into disko for declarifily configuring disks
- look into secure boot and luks unlock through tpm
- Search repo for #TODO and fix
- Go through [Scratch Pad](.github/docs/to-do.md)
-
